<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>
    <link rel="stylesheet" href="main.css">
    <script src="jquery.js"></script>
    <script src="moment.min.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class="container">
      <a class="btn" id="return">Back to Home</a>
      <section class="tweetbox"></section>  
    </div>
    <script>
      $(document).ready(function() {
        var $tweetbox = $('.tweetbox');
        $tweetbox.html('');
        $('#return').hide();
        var selectedUser;
        var index = 0;
        
        var update = function() {
          var updateDate = function() {
            $(this).find('.date').text(streams.home[$(this).attr('id')].date.from(moment()));
          };
          while (index < streams.home.length) {
            var tweet = streams.home[index];
            tweet.date = moment();
            var $tweet = $('<div class="tweet" id=' + index + '></div>');
            var $user = $('<a class="user" href="#"></a>');
            var $message = $('<span class="message"></span>');
            var $date = $('<span class="date"></span>');  
            $user.text('@' + tweet.user);
            $message.text(tweet.message);
            $tweet.append($user, $message, $date);
            $tweetbox.prepend($tweet);
            $('.tweet').each(updateDate);
            if (selectedUser && $user.text() !== selectedUser) {
              $('.tweet').first().hide();
            }
            index++; 
          }
          
          var toProfile = function() {
            $('.tweet').hide();
            $('.user:contains("' + selectedUser + '")').parent().show();
            $('#return').show();
          }

          $('.user').click(function() {
            selectedUser = $(this).text();
            toProfile();
          });
          
          $('#return').on('click', function(event) {
            $('.tweet').show();
            $(this).hide();
            selectedUser = null;
          });
          
          
        }
        
        var tweetStream = setInterval(update, 500);

      });
    </script>
  </body>
</html>
